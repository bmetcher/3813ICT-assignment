<div class="details-panel">
    <!--Channel Info-->
    <div class="details-header">
        <h5> {{ currentChannel()?.name || 'No Channel' }} </h5>
        <small class="text-muted" *ngIf="currentChannel()?.description">
            {{ currentChannel()?.description }}
        </small>
    </div>

    <!--Members List-->
    <div *ngIf="currentChannel()" class="details-content">
        <div class="section-title">
            <h6 class="flex-grow-1 m-2">Users ({{ users().length }})</h6>
        </div>
        
        <ul class="member-list" *ngIf="users().length > 0; else noUsers">
            <li *ngFor="let user of users()"
                class="member-item-wrapper"
                (mouseenter)="hoveredUser = user._id"
                (mouseleave)="hoveredUser = null">

                <div class="member-item d-flex align-items-center mb-2">
                    <img 
                        [src]="utility.getAvatarUrl(user.avatar)" 
                        class="member-avatar"
                        [alt]="user.username + 'avatar'"
                    >
                    <span class="member-name">{{ user.username }}</span>
                    <span class="badge bg-secondary" *ngIf="getUserRole(user._id) === 'admin'">
                        Admin
                    </span>

                    <!--Admin Actions-->
                    <button *ngIf="hoveredUser === user._id && canManageUser(user._id)"
                            class="gear-btn-small"
                            #gearButton
                            (click)="toggleUserDropdown(user._id, $event); $event.stopPropagation()">
                        ‚öô
                    </button>
                </div>

                <!--User Actions Dropdown-->
                <div *ngIf="showUserDropdown === user._id"
                    class="dropdown-menu-details"
                    [style.top.px]="dropdownTop"
                    [style.left.px]="dropdownLeft"
                    (click)="$event.stopPropagation()">
                    <button *ngIf="getUserRole(user._id) === 'user'"
                            (click)="promoteUser(user._id)">
                        ‚¨ÜÔ∏è Promote to Admin
                    </button>
                    <button *ngIf="getUserRole(user._id) === 'admin'"
                            (click)="demoteUser(user._id)">
                        ‚¨áÔ∏è Demote to User
                    </button>
                    <button (click)="banUser(user._id)">üö´ Ban from Channel</button>
                    <button (click)="removeUser(user._id)" class="danger">‚ùå Remove from Group</button>
                </div>
            </li>
        </ul>

        <ng-template #noUsers>
            <p class="text-muted">No members to display</p>
        </ng-template>
    </div>

    <!-- No channel selected -->
    <div *ngIf="!currentChannel()" class="text-muted text-center mt-5">
        <p>Select a channel to view details</p>
    </div>
</div>
